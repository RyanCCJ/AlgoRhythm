# 4. Best Time to Buy and Sell Stock III

## 題目
給定股票價格陣列,最多完成兩筆交易,計算最大利潤。
注意:不能同時持有多筆交易(必須先賣出才能再買入)。

## 面試重點
此題是**狀態機 DP 的經典應用**,測試對多階段決策問題的建模能力。

核心思路:
- 定義四個狀態:
  - buy1:第一次買入後的最大利潤
  - sell1:第一次賣出後的最大利潤
  - buy2:第二次買入後的最大利潤
  - sell2:第二次賣出後的最大利潤
- 狀態轉移:
  - buy1 = max(buy1, -price)
  - sell1 = max(sell1, buy1 + price)
  - buy2 = max(buy2, sell1 - price)
  - sell2 = max(sell2, buy2 + price)

面試官會重點觀察:
- 能否畫出狀態轉移圖:未持有 ↔ 持有第一筆 ↔ 已售出第一筆 ↔ 持有第二筆 ↔ 已售出第二筆
- 初始值設定:buy1 = buy2 = -∞(或 -prices[0]),sell1 = sell2 = 0
- 為何用負數表示買入:因為買入是支出
- 能否推廣到 k 筆交易的通用解法
- 空間優化:只需 4 個變數,不需陣列

**常考公司**:
- Citadel、Jane Street(量化交易公司高頻)
- Two Sigma、DE Shaw(金融科技)
- 對沖基金面試常見
- Google、Amazon 也會考

此題是**股票問題系列的進階版**,理解它能掌握所有股票交易 DP。

## 複雜度
- 時間複雜度:O(n)
- 空間複雜度:O(1)

## Follow-up
- 若允許 k 筆交易,演算法如何推廣?
- 若有交易手續費,狀態轉移如何調整?
- 若有冷卻期(賣出後需等待一天才能再買),該如何修改?
- 若 k 非常大(k >= n/2),能否簡化為無限交易?
# 15. Design Search Autocomplete System

## 題目
設計搜尋自動補全系統。給定句子列表和對應的出現次數,實作以下功能:
- input(c):使用者輸入字元 c
  - 若 c 是字母,回傳以當前輸入為前綴的前 3 個熱門句子
  - 若 c 是 '#',儲存當前句子並重置輸入
  - 熱門度定義:出現次數高優先,次數相同則字典序小優先

## 面試重點
此題測試**Trie + 堆的組合應用**,是搜尋引擎的核心功能。

核心設計:
1. **Trie 結構**:
   - 每個節點存儲經過該節點的所有句子及其次數
   - 或只存儲經過的句子,查詢時再統計
2. **input 實作**:
   - 維護當前輸入字串
   - 遍歷 Trie 到對應節點
   - 取該節點的所有句子,排序後回傳前 3 個
3. **優化**:
   - 每個 Trie 節點預存 Top 3,空間換時間
   - 用堆維護 Top K

面試官會重點觀察:
- Trie 的正確建構:句子而非單字元
- 排序規則:次數降序,字典序升序
- 當前輸入的維護:input 之間有狀態
- '#' 的處理:儲存+重置
- 空間時間權衡:預存 vs 即時計算
- 大規模數據下的優化策略

**常考公司**:
- Google(搜尋引擎核心)
- Amazon(商品搜尋)
- Airbnb、Booking.com(地點搜尋)
- 搜尋相關的所有公司

此題展現了**Trie 在實際系統中的應用**,以及如何處理 Top K 問題。

## 複雜度
- 初始化:O(N × L),N 為句子數,L 為平均長度
- input:O(p + m log m),p 為前綴長度,m 為匹配句子數
- 空間複雜度:O(N × L)

## Follow-up
- 若句子數量極大,如何優化查詢速度?
- 若要支援模糊匹配(拼寫錯誤),如何設計?
- 若要考慮使用者個人化,資料結構如何調整?
- 分散式環境下,如何分片儲存 Trie?